<!-- https://es.javascript.info/debugging-chrome -->

<!DOCTYPE html>
<html>
    <head>  
        <title>DocuWeb v3</title>
		<meta name="viewport" content="width=device-width">
    </head>
	
	<style>
		.button {
			background-color: grey;
			border: none;
			color: white;
			border-radius: 10px;
			font-size: 20px;
			height: 50px;						
			margin: 5px;
		}
		.btn {font-size: 20px; height: 40px; }
		hr { height: 10px; border: 0; box-shadow: 0 10px 10px -10px #8c8b8b inset; }
</style>


<body style="background: black; ">

<!-- CINTA SUPERIOR -->
	<div id ="idDivOpciones" style = "border: 2px solid black;">
		<div style = "height: 30px; display:flex; justify-content: space-between;align-items: center; color:orange; border: 2px solid black; font-size: 13pt">
			<input  style="background-color: #d1d1d1;width: 20%; zoom: 1.5; text-align: center; margin: 5px;" type="text" inputmode="numeric" id="idParrafo" onchange="cambiaBloque(0)"  value=2 />
			<div><input style = "zoom:1.5;" type="checkbox" id="idCbVoz" onclick="decir('')">Voz</input></div>
			<div><input style = "zoom:1.5;" type="checkbox" id="idSilenciarme" checked >Silen.</input></div>
			<button class="button"  style=" width: 20%; height: 30px; background-color: blue" type="button" onclick="toggleBodyFullScreen();">|_|</button>
		</div>
		<hr>
	</div>
	
	
<!-- CAJA PREGUNTA -->
	<div style = "display:flex;    justify-content: center;     align-items: center;">			
		<!--textarea class="prevent-select" id="idCajaPregunta" rows="10" style="width: 95%; color: white; background-color: black; font-size: 15pt; border: 0px solid blue" readonly onclick = "cambiaBloque(indiceBloqueActual+1);" ondblclick = "cambiaBloque(indiceBloqueActual-1);document.getElementById('idCbVoz').checked=true;">idCajaPregunta </textarea-->
		<textarea class="prevent-select" id="idCajaPregunta" rows="10" style="width: 95%; color: white; background-color: black; font-size: 15pt; border: 0px solid blue" readonly onclick = "cambiaBloque(indiceBloqueActual+1);">idCajaPregunta </textarea>
	</div>
	<br><hr>
	
	
<!-- BOTONES MEDIO -->
	<div id ="idDivControlParrafo" style = "display:flex;    justify-content: space-between;     align-items: center;">
		<button class="button"  style="width: 20%; background-color: brown;" type="button" onclick="irATema((arrayBloquesPregResp[indiceBloqueActual].numTema)-1);"><< Cap</button>
		<button class="button"  style="width: 20%; background-color: brown;" type="button" onclick="irATema((arrayBloquesPregResp[indiceBloqueActual].numTema)+1);">>> Cap</button>			
		<button class="button"  style="width: 20%; background-color: brown;" type="button" onclick="irATema(arrayBloquesPregResp[indiceBloqueActual].numTema)">< Cap</button>
		<button class="button"  style="width: 20%;" type="button" onclick="cambiaBloque(indiceBloqueActual-1);">P-</button>				
	</div>		
	<br><hr>
	
	
<!-- CAJA RESPUESTA -->		
	<div id="idDivCajaParrafoMio" style = "display:flex; justify-content: center; align-items: center;">
		<textarea id="idCajaRespuesta" rows="10" style="width: 95%; color: white; background-color: black; font-size: 15pt; border: 0px solid grey;" readonly onclick="clickEnCajaRespuesta();">idCajaRespuesta </textarea>
	</div>
	<br><hr>
	
	
<!-- BOTONERAS BLOQUES -->
	<div id ="idDivControlParrafo_2" style = "display:flex;    justify-content: space-between;     align-items: center;">				
		<button class="button"  style="width: 20%; background-color: #bf4390;" type="button" onclick="
		document.querySelector('#idBtnSaved').innerHTML = indiceBloqueActual;">Store</button>		
		<button id="idBtnSaved" class="button"  style="width: 20%; background-color: #004633;" type="button" onclick="cambiaBloque(Number(document.querySelector('#idBtnSaved').innerHTML));">0</button>	
		<button class="button"  style="width: 20%; background-color: orange;" type="button" onclick="decir('');document.getElementById('idCbVoz').checked=false;">X</button>
		<button class="button"  style="width: 20%; background-color: #9400d3;" type="button" onclick="alert (arrayBloquesPregResp[0].pregunta);">Info</button>
	</div>	<br><hr>
	
	<div id ="idDivControlParrafo_PC" style = "display:flex;    justify-content: space-between;     align-items: center;">
		<button id = "botonReverse" class="button"  style="width: 20%; background-color: green;" type="button" onclick="reverseModeClick()">Norm</button>				
		<button class="button"  style="width: 20%; background-color: grey;" type="button" onclick="document.getElementById('idCbVoz').checked=true;cambiaBloque(indiceBloqueActual);">Act</button>
		<button class="button"  style="width: 20%; background-color: grey;" type="button" onclick="clickEnCajaRespuesta();">Resp</button>
		<button class="button"  style="width: 20%; background-color: grey;" type="button" onclick="cambiaBloque(indiceBloqueActual+1);">P+</button>
	</div> 	<br><hr>
	
	<div id ="idDivControlParrafoRepetido" style = "display:flex;    justify-content: space-between;     align-items: center;">
		<button class="button"  style="width: 20%; background-color: brown;" type="button" onclick="irATema((arrayBloquesPregResp[indiceBloqueActual].numTema)-1);"><< Cap</button>
		<button class="button"  style="width: 20%; background-color: brown;" type="button" onclick="irATema((arrayBloquesPregResp[indiceBloqueActual].numTema)+1);">>> Cap</button>
		<button class="button"  style="width: 20%; background-color: violet;" type="button" onclick="macroConcatena();">ConCa</button>
		<button class="button"  style="width: 20%; background-color: orange;" type="button" onclick="macroCalle();">Calle</button>
	</div>	<br><hr>
	
	
<!-- CONTROLES VARIOS -->
	<br><br><br>
	<div id="idDivExtra" style = "background: black; font-size: 20pt; padding: 20px;color:blue;">
		<a href="https://pacodigo.github.io/pacodigo/DocuWeb/Docu.txt">Documento</a>
		<a href="https://pacodigo.github.io/pacodigo/DocuWeb/Docu.txt" target="_blank"> Doc en NV</a>
	
		<p> <input type="file" id="file-input" /> </p>
		<p><input style = "zoom:2;" type="checkbox" id="idCbAcortaTexto" checked> Acorta txt</input></p>
		<label>Max palabras:</label>
		<input id="idMaxPalabras" tabindex="-1" type="number" value="15" style="width: 20%; zoom: 1.5; text-align: center; margin: 5px;">
		<p></p>
		
		<div id="rate-control">
			<label for="rate">Voice Rate:</label>
			<input type="range" min="0.5" max="2" value="1" step="0.1" id="rate" />
		</div> <p></p>
		
		<button class="btn" onclick = conmutaVisualizacionDiv("idDivOpciones");>idDivOpciones</button>
		<!--button class="btn" onclick = conmutaVisualizacionDiv("idDivControlSpeaking");>idDivControlSpeaking</button>
		<button class="btn" onclick = conmutaVisualizacionDiv("idDivControlParrafo");>idDivControlParrafo</button-->		
		<button class="btn" onclick = activarEventosMouse();>Eventos mouse</button>
		<button class="btn" onclick = toggleBodyFullScreen();>Body FULL SCREEN</button>
		<button class="btn" onclick = toggleFullScreen();>FULL SCREEN</button>

		<button class="btn" onclick = "decir ('Hola Paco.')"> Test Voz </button>
		<button class="btn" onclick = "decir ('')"> Parar Voz </button>
		<br>
		<button id="idTestButton" class="btn" onclick = "irATema(1);"> Test </button>
	</div>
	
	
<!-- RECO SILVIDO -->
	<hr><p></p>
	<button  type="button" onclick="startRecoSilbido()">Start Reco Silbido</button>
	<button  type="button" onclick="stopRecoSilbido()">Stop Reco Silbido</button>
	<br><br>
	<label style = "color:blue"> Sensibilidad: <span id="sensitivityValue">8</span> 
		<input type="range" id="sensitivityRange" min="2" max="35" value="8">
	</label>
	
<!-- WAKELOCK -->
	<hr>
	<button id="wakelock-button">Activar Wakelock</button>
	<p></p> 
	<hr>
	
<!-- ESPACIO EN NEGRO -->	
	<div style="height: 150vh;" onclick = "cambiaBloque(indiceBloqueActual+1);"></div>
     <hr>   
	<div style="height: 50vh;" onclick="clickEnCajaRespuesta();"></div>
	
				
<script type="text/javascript" src="./whistleDetector.js"></script>
					
<script>
	
	
	
	
	window.onload = function() {
		console.log("Página cargada...");
		cargaDesdeInternet();
	}	
			
	function cargaDesdeInternet(){
		//fetch('https://pacodigo.github.io/pacodigo/Teatro/ElBar.txt', { signal: AbortSignal.timeout(2500) })		// Con esto no funciona en el movil del curro.
		fetch('https://pacodigo.github.io/pacodigo/DocuWeb/Docu.txt')
			.then(response => response.text())
			.then((data) => {
				console.log ("Datos recibidos de Internet: " + data);
				procesadoFichero(data);
				/* let parrafoSolicitado = getCookie("numParrafoCookie"); 
				if (parrafoSolicitado != "" && parrafoSolicitado != null) {
					document.querySelector('#idParrafo').value = parrafoSolicitado;	
					cambiaBloque();
				}*/
			})
			.catch(err => {
				alert("ERROR: " + err);
			});	 
	}

	
	var arrayBloquesPregResp = [];
	var indiceBloqueActual = 0;
	
	function procesadoFichero(textoEnBruto){
		console.log ("procesadoFichero");
		
		let arrayDeLineas = textoEnBruto.split('\n');		

		let bloquePregResp = {					// Objeto "bloquePregResp"
			pregunta: 			"Pregunta",		// Clave / Valor. En la Clave personaje se almacena el Valor NULO
			respuesta: 			"Respuesta",
			tema:				"TEMAS: ",
			numTema:			0,
			controlUsada: 		false
			};
		
		var indiceArrayBloquesPregResp=1;
		var temaActual ="";
		var numTema = 0;
		var numBloquesDeTema=0;
		arrayBloquesPregResp[0] = { ...bloquePregResp};	// Aquí cargaremos datos inciales.
		var infoProcesada = "";
		var numRegistrosPorTema;
		
		for (let indiceLineas=0; indiceLineas<arrayDeLineas.length; indiceLineas++){
			let divisionLinea = arrayDeLineas[indiceLineas].split(':');
			if (divisionLinea.length > 1){			
				arrayBloquesPregResp[indiceArrayBloquesPregResp] = { ...bloquePregResp};	// Creamos un nuevo objeto en el array en pos [0] y clonamos el objeto usando el operador de propagación. Copiamos su contenid
				arrayBloquesPregResp[indiceArrayBloquesPregResp].pregunta = divisionLinea[0];	
				arrayBloquesPregResp[indiceArrayBloquesPregResp].respuesta = divisionLinea[1].replace(/\t/g, '');	// Quitamos también posibles tabuladores.
				arrayBloquesPregResp[indiceArrayBloquesPregResp].tema = temaActual;
				arrayBloquesPregResp[indiceArrayBloquesPregResp].numTema = numTema;					
				indiceArrayBloquesPregResp++;
				numBloquesDeTema++;
			}
			else if (arrayDeLineas[indiceLineas].length >2) {		// NUEVO TEMA. Única línea. Texto de control o Tema
				if (numTema>0)	// Para no añadir el primer tema que está vació.
				infoProcesada = infoProcesada + numTema.toString() + " - " + temaActual + "(" + numBloquesDeTema.toString()+ ")\n";
				temaActual = arrayDeLineas[indiceLineas];
				numTema++;
				numBloquesDeTema = 0;
			}
		}
		
		console.log (arrayBloquesPregResp);
		infoProcesada = infoProcesada + ("\n\nTemas: " + (numTema-1) + "\nBloques Preg+Resp: " + arrayBloquesPregResp.length);
		console.log (infoProcesada);
		//document.getElementById('idCajaPregunta').value = infoProcesada;
		arrayBloquesPregResp[0].pregunta = infoProcesada;
		cambiaBloque(0);
	}
	
	
	function cambiaBloque(nuevoBloqueSolicitado){
		var parrafoSolicitado = nuevoBloqueSolicitado;		
		/*
		if (parrafoSolicitado<0){		// Num párrafo negativo >> Ha metido una pagina
			var paginaSolicitada = -parrafoSolicitado;
			parrafoSolicitado = devuelveRegistroDePagina(paginaSolicitada);
			document.querySelector('#idParrafo').value = parrafoSolicitado;
			setCookie("numParrafoCookie", parrafoSolicitado);
		}
		if ((0<parrafoSolicitado) && (parrafoSolicitado<1)){		// Num párrafo decimales 0.03>> Ha metido un título
			var capituloSolicitado = Math.trunc(parrafoSolicitado*100);		// Devuelve la parte entera, removiendo los decimales. A veces me sale 7,000000001
			console.log ("Solicitando capítulo " + capituloSolicitado);
			parrafoSolicitado = devuelveRegistroDeCapitulo(capituloSolicitado);
			document.querySelector('#idParrafo').value = parrafoSolicitado;
			setCookie("numParrafoCookie", parrafoSolicitado);
		}
		*/
		if (parrafoSolicitado > arrayBloquesPregResp.length-1){
			document.getElementById('idCajaPregunta').value = "NO HAY MÁS PREGUNTAS";
			return;
		}
		indiceBloqueActual = nuevoBloqueSolicitado;								// Actualizamos la variable
		document.querySelector('#idParrafo').value = nuevoBloqueSolicitado		// A extinguir
		
		let textoPregunta = arrayBloquesPregResp[parrafoSolicitado].tema + "\n\n" + arrayBloquesPregResp[parrafoSolicitado].pregunta;
		document.getElementById('idCajaPregunta').value = textoPregunta;
		document.getElementById('idCajaRespuesta').value = arrayBloquesPregResp[parrafoSolicitado].respuesta;
		
		if (document.getElementById("idCbVoz").checked){					// Si Voz=On		
			if (document.getElementById("idCbAcortaTexto").checked)
				decir (acortarTexto(arrayBloquesPregResp[parrafoSolicitado].pregunta));
				//decirConcatenado (acortarTexto(textoParrafoAnterior),1);
			else
				decir (arrayBloquesPregResp[parrafoSolicitado].pregunta);		
			// Parte respuesta:
			if (!document.getElementById("idSilenciarme").checked){
				var textoResp = arrayBloquesPregResp[parrafoSolicitado].respuesta;
				decirConcatenadoPromise ("O:" + textoResp, 1);
			}
		}	
	}

	
	function irATema(numTemaSolicitado){
		for (i=0; i<arrayBloquesPregResp.length; i++){
			if (arrayBloquesPregResp[i].numTema == numTemaSolicitado){
				cambiaBloque(i);
				return;
			}
		}
	}

	
	function activarEventosMouse(){
		// Right-Click Mouse detection:
		document.getElementById('idCajaPregunta').onmousedown = function(event) {
			if (event.which == 3){ 		// Right-Click Mouse 
				//document.getElementById('idCbVoz').checked=false;
				document.querySelector('#idParrafo').value--; cambiaBloque();  // Parrafo Anterior
				}
			if (event.which == 2) 		// Click en Rueda
				decir('');
		}
		// On Wheel Mouse event:
		document.getElementById("idCajaPregunta").onwheel = function(event) {
			if (event.deltaY > 0) {		// down
				//alert ("Down");
				clickEnCajaRespuesta();	// Decir mi párrafo
				}
			else {						// up
				//alert ("Up");
				document.getElementById('idCbVoz').checked=true; cambiaBloque();	// Repite el actual
				}
			}
	}	
	
	
	function clickEnCajaRespuesta(){
		console.log ("clickEnCajaRespuesta");
		if (document.getElementById("idCbVoz").checked){
			var parrafoSolicitado = document.querySelector('#idParrafo').value;	
			decir (arrayBloquesPregResp[parrafoSolicitado].respuesta);
		}
		else {
			if (document.getElementById('idCajaRespuesta').style.color!="white")		
				document.getElementById('idCajaRespuesta').style.color="white";
			else
				document.getElementById('idCajaRespuesta').style.color="black";
		}
	}
	
	function acortarTexto (textoEntrada){
		var arrayDePalabras = textoEntrada.split(' ');
		var numPalabras = arrayDePalabras.length;
		var numMaxPalabras = document.querySelector('#idMaxPalabras').value;	; 	//Antes 10
		var respuesta ="Corto: ";	//Antes: "Recortado: " > Recorta
		if (numPalabras > numMaxPalabras){
			for (indicePalabras = (numPalabras-numMaxPalabras); indicePalabras<numPalabras; indicePalabras++){
			respuesta = respuesta + " " + arrayDePalabras[indicePalabras];
			}
		}
		else 
			respuesta = textoEntrada;
		return (respuesta);	
	}
	
	function conmutaVisualizacionDiv(divID){
	    var x = document.getElementById(divID);
		if (x.style.display === "none") {
			x.style.display = "block";
		} else {
			x.style.display = "none";
		}
	}
	
	function toggleFullScreen() {			// Mio: document.querySelector('body').requestFullscreen();
		if (!document.fullscreenElement) 
			document.documentElement.requestFullscreen();
		else 
			document.exitFullscreen();
	}
	
	function toggleBodyFullScreen(){		//document.querySelector('body').requestFullscreen();
		if (!document.fullscreenElement) 
			document.querySelector('body').requestFullscreen();
		else 
			document.exitFullscreen();
	}
	

	// Fichero de entrada:
	document.getElementById('file-input').addEventListener('change', leerArchivo, false);
	function leerArchivo(e) {
		var archivo = e.target.files[0];
		if (!archivo) {
			return;
		}
		var lector = new FileReader();
		lector.onload = function(e) {
			var contenido = e.target.result;
			procesadoFichero(contenido);
		}
		lector.readAsText(archivo);
	}

	const rate = document.querySelector("#rate");
	
	function decir (enteredText){
		const speechSynth = window.speechSynthesis;   
		speechSynth.cancel();
		const newUtter = new SpeechSynthesisUtterance(enteredText);
		newUtter.rate = rate.value;			// Opcional
		speechSynth.speak(newUtter);
		newUtter.onend = () => console.log("Fin");
	}


	function macroConcatena(){
		var parrafoSolicitado = document.querySelector('#idParrafo').value;		
		var indiceMiParrafo = indicesParrafosDePaco[parrafoSolicitado-1];
		var textoParrafoAnterior = arrayParrafos[indiceMiParrafo-1].texto;
		if (document.getElementById("idCbAcortaTexto").checked)
			textoParrafoAnterior= acortarTexto(textoParrafoAnterior);
		var textoMiParrafo = arrayParrafos[indiceMiParrafo].texto;
		decirConcatenadoPromise ("U:" + textoParrafoAnterior, 1);
		decirConcatenadoPromise ("Silencio.",0);			// Añado un silencio en plan cutre.
		var volumen = !(document.getElementById("idSilenciarme").checked);
		/*
		if (document.getElementById("idSilenciarme").checked)
			decirConcatenado (textoMiParrafo, 0);		//decirConcatenado (textoMiParrafo, 0.5);
		else
			decirConcatenado ("O:" + textoMiParrafo, 1);
		parrafoSolicitado++;
		decirConcatenado ("Sile.",0);			// Añado un silencio en plan cutre.
		*/
		decirConcatenadoPromise("O:" + textoMiParrafo, volumen)
			.then (function(){
				document.querySelector('#idParrafo').value++; 
				var parrafoSolicitado = document.querySelector('#idParrafo').value;		
				var indiceMiParrafo = indicesParrafosDePaco[parrafoSolicitado-1];
				document.getElementById('idCajaRespuesta').value = getTodaInfoDeParrafo(indiceMiParrafo);
				document.getElementById('idCajaPregunta').value = getTodaInfoDeParrafo(indiceMiParrafo-1);
				macroConcatena();
			});
			
			
		/*		
		decirConcatenado ("Fin.", 1);
		document.querySelector('#idParrafo').value = parrafoSolicitado;
		//cambiaBloque();
		var indiceMiParrafo = indicesParrafosDePaco[parrafoSolicitado-1];
		document.getElementById('idCajaRespuesta').value = getTodaInfoDeParrafo(indiceMiParrafo);
		document.getElementById('idCajaPregunta').value = getTodaInfoDeParrafo(indiceMiParrafo-1);
	*/
	}

	function decirConcatenadoPromise (enteredText, volumen){
		const speechSynth = window.speechSynthesis;   
		const newUtter = new SpeechSynthesisUtterance(enteredText);
		newUtter.volume = volumen;
		speechSynth.speak(newUtter);
		
		return new Promise (function(resolve){				// Constructor del Objeto Promise. Se le pasa como argumento una 'function'. Esta function tiene 2 argumentos, que son dos funciones?
			newUtter.onend = (function(){
				//console.log("Fin.");
				resolve("Promise is resolved!");
			});
		});
	}
		
		
	// Cookies   https://www.w3schools.com/js/js_cookies.asp	
	function setCookie(cname, cvalue) {
	  const d = new Date();
	  d.setTime(d.getTime() + (365 * 24 * 60 * 60 * 1000));
	  let expires = "expires="+d.toUTCString();
	  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}

	function getCookie(cname) {
	  let name = cname + "=";
	  let ca = document.cookie.split(';');
	  for(let i = 0; i < ca.length; i++) {
		let c = ca[i];
		while (c.charAt(0) == ' ') {
		  c = c.substring(1);
		}
		if (c.indexOf(name) == 0) {
		  return c.substring(name.length, c.length);
		}
	  }
	  return "";
	}



	// __Reverse Mode__
	
	let reverseMode = false;
	const botonReverse = document.getElementById("botonReverse");
	function reverseModeClick(){
		if (!reverseMode){
			reverseMode = true;
			botonReverse.textContent = "REVR";
			botonReverse.style.backgroundColor = "red";
			for (indice = 1 ; indice < arrayBloquesPregResp.length; indice++){
				let pregunta = arrayBloquesPregResp[indice].pregunta;
				let respuesta = arrayBloquesPregResp[indice].respuesta;
				arrayBloquesPregResp[indice].pregunta = respuesta;
				arrayBloquesPregResp[indice].respuesta = pregunta;
			}
		}
		else {
			reverseMode = false;
			botonReverse.textContent = "Norm";
			botonReverse.style.backgroundColor = "green";
			for (indice = 1 ; indice < arrayBloquesPregResp.length; indice++){
				let pregunta = arrayBloquesPregResp[indice].pregunta;
				let respuesta = arrayBloquesPregResp[indice].respuesta;
				arrayBloquesPregResp[indice].pregunta = respuesta;
				arrayBloquesPregResp[indice].respuesta = pregunta;
			}
		}
	}


	function macroCalle(){
		document.getElementById('idCbVoz').checked=true;
		//document.getElementById("idSilenciarme").checked=false;
		toggleFullScreen();
		startRecoSilbido();
		if (!wakelock) {								// Si NO ya hay un wakelock activo...
            requestWakelock();
		}
		window.scrollTo(0, document.body.scrollHeight);	// Va al final de la página.
	}
	
	

// __ PARTE RECOSILVIDO__

	whistleDetector.setConfig({
			sampleThreshold : 8			//8
		})
	var activoRecoSilvido = true;
	function startRecoSilbido(){
		whistleDetector.detect(function(){
			if (activoRecoSilvido){
				activoRecoSilvido = false;
				console.log ("Silbido detectado.");
				//stopRecoSilbido	();
				document.body.style.background = "#ff0000";
				setTimeout (function(){
					document.body.style.background = "#000000";
					//startRecoSilbido();
					activoRecoSilvido = true;
					}, 3*1000);
				cambiaBloque(indiceBloqueActual+1);
			}
		});
	}
	function stopRecoSilbido(){
		whistleDetector.stop();	
	}
	const sensitivityRange = document.getElementById("sensitivityRange");
	const sensitivityValue = document.getElementById("sensitivityValue");
	sensitivityRange.addEventListener("input", () => {
		  const nuevoValor = Number(sensitivityRange.value);
		  whistleDetector.setConfig({ sampleThreshold: nuevoValor });
		  sensitivityValue.textContent = sensitivityRange.value;
	}); 




// __PARTE WAKELOCK__


const button = document.getElementById("wakelock-button");		// Obtenemos una referencia al botón
let wakelock = null;											// Declaramos una variable para guardar el objeto WakeLockSentinel

async function requestWakelock() {								// Definimos una función para solicitar un wakelock
    try {
        if ("wakeLock" in navigator) {					        // Comprobamos si el navegador soporta la Wakelock API
            wakelock = await navigator.wakeLock.request("screen");
            console.log("Wakelock activado");
            button.textContent = "Desactivar Wakelock";
            wakelock.addEventListener("release", () => {		// Añadimos un listener para el evento release, para cuando se libera el wakelock                
                button.textContent = "Activar Wakelock";		// Cambiamos el texto del botón
            });
        } else {												// Mostramos un mensaje de error por consola
            console.error("El navegador no soporta la Wakelock API");
        }
    } catch (error) {
        console.error(error);
    }
}

async function releaseWakelock() {				// Definimos una función para liberar un wakelock
    if (wakelock) {								// Comprobamos si hay un wakelock activo
        await wakelock.release();				// Y si es así lo liberamos
        wakelock = null;						// Asignamos null a la variable wakelock				
    }
    console.log("Wakelock liberado");
}

button.addEventListener("click", () => {		// Añadimos un listener para el evento click del botón para activar o desactivar el wakelock
    if (wakelock) {								// Si ya hay un wakelock activo...
        releaseWakelock();						// ...llamamos a la función para liberar el wakelock
    } else {
        requestWakelock();						// Si no l ohay, llamamos a la función para solicitar el wakelock
    }
});



			
			
		</script>
    </body>
</html>